name=micropython
from_source=micropython
revision=1
imagedeps="git python gcc"
hostdeps="gcc automake pkg-config"
deps="mlibc"

configure() {
	true
}

build() {
	cp -rp "${source_dir}"/. ./
	cd ./ports/minimal
	make clean
	make CC=x86_64-polaris-gcc -j${parallelism}
}

install() {
	cd ./ports/minimal/build
	mkdir -p "${dest_dir}/usr/bin"
	mv ./firmware.elf ./micropython
	cp ./micropython "${dest_dir}/usr/bin"
}
